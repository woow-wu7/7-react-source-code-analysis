"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var n=require("@reach/auto-id"),t=require("@reach/popover"),a=require("@reach/descendants"),r=require("@reach/utils");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=o(e),i=o(t);function d(){return(d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function s(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n.indexOf(t=o[a])>=0||(r[t]=e[t]);return r}var c=a.createDescendantContext("MenuDescendantContext"),l=r.createNamedContext("MenuContext",{}),f={buttonId:null,isExpanded:!1,typeaheadQuery:"",selectionIndex:-1},E=r.forwardRefWithAs((function(n,t){var o=n.as,i=void 0===o?"button":o,d=n.onKeyDown,f=n.onMouseDown,E=n.id,p=s(n,["as","onKeyDown","onMouseDown","id"]),v=e.useContext(l),x=v.buttonRef,y=v.buttonClickedRef,_=v.menuId,m=v.state,I=m.buttonId,w=m.isExpanded,b=v.dispatch,C=r.useForkedRef(x,t),h=a.useDescendants(c),T=e.useMemo((function(){return h.findIndex((function(e){return!e.disabled}))}),[h]);return e.useEffect((function(){var e=null!=E?E:_?r.makeId("menu-button",_):"menu-button";I!==e&&b({type:"SET_BUTTON_ID",payload:e})}),[I,b,E,_]),u.default.createElement(i,Object.assign({"aria-expanded":!!w||void 0,"aria-haspopup":!0,"aria-controls":_},p,{ref:C,"data-reach-menu-button":"",id:I||void 0,onKeyDown:r.wrapEvent(d,(function(e){switch(e.key){case"ArrowDown":case"ArrowUp":e.preventDefault(),b({type:"OPEN_MENU_AT_INDEX",payload:{index:T}});break;case"Enter":case" ":b({type:"OPEN_MENU_AT_INDEX",payload:{index:T}})}})),onMouseDown:r.wrapEvent(f,(function(e){w||(y.current=!0),M(e.nativeEvent)||b(w?{type:"CLOSE_MENU",payload:{buttonRef:x}}:{type:"OPEN_MENU_CLEARED"})})),type:"button"}))})),p=r.forwardRefWithAs((function(n,t){var o=n.as,i=n.index,d=n.isLink,f=void 0!==d&&d,E=n.onClick,p=n.onDragStart,v=n.onMouseDown,x=n.onMouseEnter,y=n.onMouseLeave,_=n.onMouseMove,m=n.onMouseUp,b=n.onSelect,C=n.disabled,h=n.valueText,T=s(n,["as","index","isLink","onClick","onDragStart","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseUp","onSelect","disabled","valueText"]),D=e.useContext(l),R=D.buttonRef,L=D.dispatch,k=D.readyToSelect,O=D.selectCallbacks,N=D.state,S=N.selectionIndex,A=N.isExpanded,g=e.useRef(null),U=e.useState(h||""),P=U[0],j=U[1],X=e.useCallback((function(e){e&&(g.current=e,(!h||e.textContent&&P!==e.textContent)&&j(e.textContent))}),[P,h]),F=r.useForkedRef(t,X),K=e.useRef(!1),q=a.useDescendant({element:g.current,key:P,disabled:C,isLink:f},c,i),B=q===S&&!C;function W(){w(R.current),b&&b(),L({type:"CLICK_MENU_ITEM"})}return O.current[q]=b,e.useEffect((function(){A||(k.current=!1)}),[A,k]),e.useEffect((function(){var e=r.getOwnerDocument(g.current)||document,n=function(){return K.current=!1};return e.addEventListener("mouseup",n),function(){return e.removeEventListener("mouseup",n)}}),[]),u.default.createElement(o,Object.assign({role:"menuitem",id:I(q),tabIndex:-1},T,{ref:F,"aria-disabled":C||void 0,"data-reach-menu-item":"","data-selected":B?"":void 0,"data-valuetext":P,onClick:r.wrapEvent(E,(function(e){f&&!M(e.nativeEvent)&&(C?e.preventDefault():W())})),onDragStart:r.wrapEvent(p,(function(e){f&&e.preventDefault()})),onMouseDown:r.wrapEvent(v,(function(e){M(e.nativeEvent)||(f?K.current=!0:e.preventDefault())})),onMouseEnter:r.wrapEvent(x,(function(e){B||null==q||C||L({type:"SELECT_ITEM_AT_INDEX",payload:{index:q}})})),onMouseLeave:r.wrapEvent(y,(function(e){L({type:"CLEAR_SELECTION_INDEX"})})),onMouseMove:r.wrapEvent(_,(function(){k.current=!0,B||null==q||C||L({type:"SELECT_ITEM_AT_INDEX",payload:{index:q}})})),onMouseUp:r.wrapEvent(m,(function(e){k.current?M(e.nativeEvent)||(f?K.current?K.current=!1:g.current&&g.current.click():C||W()):k.current=!0}))}))})),v=r.forwardRefWithAs((function(e,n){var t=e.as,a=void 0===t?"div":t,r=s(e,["as"]);return u.default.createElement(p,Object.assign({},r,{ref:n,as:a}))})),x=r.forwardRefWithAs((function(n,t){var o=n.as,i=void 0===o?"div":o,d=n.children,f=n.onKeyDown,E=s(n,["as","children","id","onKeyDown"]),p=e.useContext(l),v=p.menuId,x=p.dispatch,y=p.buttonRef,_=p.menuRef,m=p.selectCallbacks,M=p.state,b=M.isExpanded,C=M.buttonId,h=M.selectionIndex,T=M.typeaheadQuery,D=a.useDescendants(c),R=r.useForkedRef(_,t);e.useEffect((function(){var e=function(e,n){if(void 0===n&&(n=""),!n)return null;var t=e.find((function(e){var t,a,r;return!e.disabled&&(null===(t=e.element)||void 0===t||null===(a=t.dataset)||void 0===a||null===(r=a.valuetext)||void 0===r?void 0:r.toLowerCase().startsWith(n))}));return t?e.indexOf(t):null}(D,T);T&&null!=e&&x({type:"SELECT_ITEM_AT_INDEX",payload:{index:e}});var n=window.setTimeout((function(){return T&&x({type:"SEARCH_FOR_ITEM",payload:""})}),1e3);return function(){return window.clearTimeout(n)}}),[x,D,T]);var L=r.usePrevious(D.length),k=r.usePrevious(D[h]),O=r.usePrevious(h);e.useEffect((function(){h>D.length-1?x({type:"SELECT_ITEM_AT_INDEX",payload:{index:D.length-1}}):L!==D.length&&h>-1&&k&&O===h&&D[h]!==k&&x({type:"SELECT_ITEM_AT_INDEX",payload:{index:D.findIndex((function(e){return e.key===k.key}))}})}),[x,D,L,k,O,h]);var N=r.wrapEvent((function(e){var n=e.key;if(b)switch(n){case"Enter":case" ":var t=D.find((function(e){return e.index===h}));t&&(t.isLink&&t.element?t.element.click():(e.preventDefault(),w(y.current),m.current[t.index]&&m.current[t.index](),x({type:"CLICK_MENU_ITEM"})));break;case"Escape":w(y.current),x({type:"CLOSE_MENU",payload:{buttonRef:y}});break;case"Tab":e.preventDefault();break;default:if(r.isString(n)&&1===n.length){var a=T+n.toLowerCase();x({type:"SEARCH_FOR_ITEM",payload:a})}}}),a.useDescendantKeyDown(c,{currentIndex:h,orientation:"vertical",rotate:!1,filter:function(e){return!e.disabled},callback:function(e){x({type:"SELECT_ITEM_AT_INDEX",payload:{index:e}})},key:"index"}));return u.default.createElement(i,Object.assign({"aria-activedescendant":I(h)||void 0,"aria-labelledby":C||void 0,role:"menu",tabIndex:-1},E,{ref:R,"data-reach-menu-items":"",id:v,onKeyDown:r.wrapEvent(f,N)}),d)})),y=r.forwardRefWithAs((function(e,n){var t=e.as,a=void 0===t?"a":t,o=e.component,i=e.onSelect,d=s(e,["as","component","onSelect"]);return o&&console.warn("[@reach/menu-button]: Please use the `as` prop instead of `component`."),u.default.createElement("div",{role:"none",tabIndex:-1},u.default.createElement(p,Object.assign({},d,{ref:n,"data-reach-menu-link":"",as:a,isLink:!0,onSelect:i||r.noop})))})),_=e.forwardRef((function(e,n){var t=e.portal,a=void 0===t||t,r=s(e,["portal"]);return u.default.createElement(m,{portal:a},u.default.createElement(x,Object.assign({},r,{ref:n,"data-reach-menu-list":""})))})),m=e.forwardRef((function(n,t){var a=n.children,o=n.portal,c=void 0===o||o,f=n.position,E=s(n,["children","portal","position"]),p=e.useContext(l),v=p.buttonRef,x=p.buttonClickedRef,y=p.dispatch,_=p.menuRef,m=p.popoverRef,I=p.state.isExpanded,M=r.useForkedRef(m,t);e.useEffect((function(){function e(e){x.current?x.current=!1:I&&m.current&&(m.current.contains(e.target)||y({type:"CLOSE_MENU",payload:{buttonRef:v}}))}return window.addEventListener("mousedown",e),function(){window.removeEventListener("mousedown",e)}}),[x,v,y,I,_,m]);var w=d({ref:M,"data-reach-menu":"","data-reach-menu-popover":"",hidden:!I,children:a},E);return c?u.default.createElement(i.default,Object.assign({},w,{targetRef:v,position:f})):u.default.createElement("div",Object.assign({},w))}));function I(n){var t=e.useContext(l);return null!=n&&n>-1?r.makeId("option-"+n,t.menuId):void 0}function M(e){return 3===e.which||2===e.button}function w(e){e&&e.focus()}function b(e,n){switch(void 0===n&&(n={}),n.type){case"CLICK_MENU_ITEM":case"CLOSE_MENU":return d({},e,{isExpanded:!1,selectionIndex:-1});case"OPEN_MENU_AT_FIRST_ITEM":return d({},e,{isExpanded:!0,selectionIndex:0});case"OPEN_MENU_AT_INDEX":return d({},e,{isExpanded:!0,selectionIndex:n.payload.index});case"OPEN_MENU_CLEARED":return d({},e,{isExpanded:!0,selectionIndex:-1});case"SELECT_ITEM_AT_INDEX":return n.payload.index>=0?d({},e,{selectionIndex:null!=n.payload.max?Math.min(Math.max(n.payload.index,0),n.payload.max):Math.max(n.payload.index,0)}):e;case"CLEAR_SELECTION_INDEX":return d({},e,{selectionIndex:-1});case"SET_BUTTON_ID":return d({},e,{buttonId:n.payload});case"SEARCH_FOR_ITEM":return void 0!==n.payload?d({},e,{typeaheadQuery:n.payload}):e;default:return e}}exports.Menu=function(t){var o=t.id,i=t.children,d=e.useRef(null),s=e.useRef(null),E=e.useRef(null),p=a.useDescendantsInit(),v=p[0],x=p[1],y=e.useReducer(b,f),_=y[0],m=y[1],I=n.useId(o),M=o||r.makeId("menu",I),C=e.useRef(!1),h=e.useRef([]),T=e.useRef(!1),D={buttonRef:d,dispatch:m,menuId:M,menuRef:s,popoverRef:E,buttonClickedRef:C,readyToSelect:T,selectCallbacks:h,state:_};return e.useEffect((function(){_.isExpanded?(window.__REACH_DISABLE_TOOLTIPS=!0,window.requestAnimationFrame((function(){w(s.current)}))):window.__REACH_DISABLE_TOOLTIPS=!1}),[_.isExpanded]),e.useEffect((function(){return r.checkStyles("menu-button")}),[]),u.default.createElement(a.DescendantProvider,{context:c,items:v,set:x},u.default.createElement(l.Provider,{value:D},r.isFunction(i)?i({isExpanded:_.isExpanded,isOpen:_.isExpanded}):i))},exports.MenuButton=E,exports.MenuItem=v,exports.MenuItems=x,exports.MenuLink=y,exports.MenuList=_,exports.MenuPopover=m,exports.useMenuButtonContext=function(){var n=e.useContext(l).state.isExpanded;return e.useMemo((function(){return{isExpanded:n}}),[n])};
//# sourceMappingURL=menu-button.cjs.production.min.js.map
